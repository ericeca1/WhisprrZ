{header}
{search}

<!-- Add stylesheet links with updated paths to Edge folder -->
<link rel="stylesheet" href="{url_main}_frameworks/main/whisprrz_Edge/css/looking_glass.css">
<link rel="stylesheet" href="{url_main}_frameworks/main/whisprrz_Edge/css/modals.css">
<link rel="stylesheet" href="{url_main}_frameworks/main/whisprrz_Edge/css/calendar.css">
<link rel="stylesheet" href="{url_main}_frameworks/main/whisprrz_Edge/css/gear_modal.css">

<!-- Load gallery.js -->
<script src="{url_main}_frameworks/main/whisprrz_Edge/js/gallery.js{cache_version_param}"></script>

<!-- Fix modal styling directly in the page -->
<style>
#gearModal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    overflow: auto;
}

#gearModal .modal-content {
    background: white;
    width: 400px;
    padding: 20px;
    margin: 10% auto;
    border-radius: 10px;
    text-align: center;
    position: relative;
    max-width: 90%;
}

#gearModal .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    cursor: pointer;
    font-size: 20px;
}

#gearModal .save-btn {
    background-color: #007bff;
    color: white;
    padding: 10px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    margin-top: 10px;
    width: 100%;
}

.pref-section {
    margin-bottom: 15px;
    text-align: left;
}

#gearModal select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}

#gearModal .checkbox-group, 
#gearModal .radio-group {
    text-align: left;
    margin-top: 5px;
}

#gearModal label {
    display: block;
    margin-bottom: 5px;
    cursor: pointer;
}
</style>

<!-- Prevent header from showing in middle of page with proper structure -->
<div class="looking-glass-wrapper" id="looking-glass-main-container">
    <!-- begin_looking_glass_group -->
    <div class="looking-glass-container">
        <div class="looking-glass-header">
            <h5 class="sub-group-title">LookinGlass</h5>

            <div class="tabbable-panel">
                <div class="tabbable-line">
                    <ul class="nav nav-tabs">
                        <li>
                            <a href="javascript:void(0);" onclick="showSearchModal(); return false;" data-toggle="modal" data-target="#lookingGlassSearchModal">Search</a>
                        </li>
                        <li class="friends-tab">
                            <a href="{url_page_photos_list}?offset=friends" onclick="loadTab('friends', '{url_page_photos_list}?offset=friends'); return false;">Friends</a>
                        </li>
                        <li class="online-tab">
                            <a href="{url_page_photos_list}?offset=online" onclick="loadTab('online', '{url_page_photos_list}?offset=online'); return false;">Online</a>
                        </li>
                        <li class="matches-tab">
                            <a href="{url_page_photos_list}?offset=matches" onclick="loadTab('matches', '{url_page_photos_list}?offset=matches'); return false;">Matches</a>
                        </li>
                        <li class="nearby-tab">
                            <a href="{url_page_photos_list}?offset=nearby" onclick="loadTab('nearby', '{url_page_photos_list}?offset=nearby'); return false;">User Near</a>
                        </li>
                     </ul>
                </div>
            </div>

            <div class="feed_head_txt">
                <a class="icon_setting_gear" href="javascript:void(0);" onclick="openGearModal(); return false;"></a>
            </div>
        </div>

        <div class="clearfix"></div>
        <div><hr></div>

        <div class="blogs_wrap page_list {page_class}">
            <div class="list-container">
                <div class="module_filter_result">
                    <!-- Photos content block -->
                    <div class="content-section photos-section">
                        <div class="section-header">
                            <h4>Photos</h4>
                            <div class="section-tabs">
                                <ul class="nav nav-pills photo-tabs">
                                    <li class="photos-filter-all active"><a href="#" onclick="filterPhotos('all'); return false;">All Photos</a></li>
                                    <li class="photos-filter-recent"><a href="#" onclick="filterPhotos('recent'); return false;">Recent Uploads</a></li>
                                    <li class="photos-filter-popular"><a href="#" onclick="filterPhotos('popular'); return false;">Most Viewed</a></li>
                                    <li class="photos-filter-featured"><a href="#" onclick="filterPhotos('featured'); return false;">Featured</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="section-subtitle">
                            <p>Browse and discover member photos from around the community</p>
                        </div>
                        <div class="row filter_result gallery-container photos-container">
                            <!-- begin_photo_items -->
                            {photo_item}
                            <!-- end_photo_items -->
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- Videos content block -->
                    <div class="content-section videos-section">
                        <div class="section-header">
                            <h4>Video Collection</h4>
                            <div class="section-tabs">
                                <ul class="nav nav-pills video-tabs">
                                    <li class="videos-filter-all active"><a href="#" onclick="filterVideos('all'); return false;">All Videos</a></li>
                                    <li class="videos-filter-recent"><a href="#" onclick="filterVideos('recent'); return false;">Latest</a></li>
                                    <li class="videos-filter-trending"><a href="#" onclick="filterVideos('trending'); return false;">Trending</a></li>
                                    <li class="videos-filter-popular"><a href="#" onclick="filterVideos('popular'); return false;">Popular</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="section-subtitle">
                            <p>Watch videos shared by members in the community</p>
                        </div>
                        <div class="row filter_result gallery-container videos-container">
                            <!-- begin_video_items -->
                            {video_item}
                            <!-- end_video_items -->
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- Live videos content block -->
                    <div class="content-section live-videos-section">
                        <div class="section-header">
                            <h4>Live Broadcasts</h4>
                            <div class="section-tabs">
                                <ul class="nav nav-pills live-tabs">
                                    <li class="live-filter-trending active"><a href="#" onclick="filterLiveStreams('trending'); return false;">Hot Now</a></li>
                                    <li class="live-filter-new"><a href="#" onclick="filterLiveStreams('new'); return false;">Just Started</a></li>
                                    <li class="live-filter-followed"><a href="#" onclick="filterLiveStreams('followed'); return false;">Friends Live</a></li>
                                    <li class="live-filter-go-live"><a href="#" onclick="goLive(); return false;" class="go-live-btn">Go Live</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="section-subtitle">
                            <p>Join live broadcasts from your favorite community members</p>
                        </div>
                        <div class="row filter_result gallery-container live-container">
                            <!-- begin_live_video_items -->
                            {live_video_item}
                            <!-- end_live_video_items -->
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- Partyhouz content block -->
                    <div class="content-section partyhouz-section">
                        <div class="section-header">
                            <h4>Partyhouz Events</h4>
                            <div class="section-tabs">
                                <ul class="nav nav-pills partyhouz-tabs">
                                    <li class="partyhouz-filter-upcoming active"><a href="#" onclick="filterPartyhouz('upcoming'); return false;">Live</a></li>
                                    <li class="partyhouz-filter-trending"><a href="#" onclick="filterPartyhouz('trending'); return false;">Trending</a></li>
                                    <li class="partyhouz-filter-my"><a href="#" onclick="filterPartyhouz('my'); return false;">Past Live</a></li>
                                    <li class="partyhouz-filter-create"><a href="#" onclick="createPartyEvent(); return false;" class="create-event-btn">Create Event</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="section-subtitle">
                            <p>Discover and join exciting events in your community</p>
                        </div>
                        <div class="row filter_result gallery-container partyhouz-container">
                            <!-- begin_partyhouz_items -->
                            {partyhouz_item}
                            <!-- end_partyhouz_items -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end_looking_glass_group -->
</div>

<!-- Updated Gear Modal -->
<div id="gearModal" class="modal">
    <div class="modal-content">
        <h2>User Preferences</h2>
        <span class="close-btn" onclick="closeGearModal()">&times;</span>
        <div class="modal-body">
            <!-- Preferences Content -->
            <div class="pref-section">
                <label for="defaultContent">Default View Show On Top:</label>
                <select id="defaultContent" class="pref-select">
                    <option value="photos" selected>Photos</option>
                    <option value="videos">Videos</option>
                    <option value="live">Live Streams</option>
                    <option value="partyhouz">Partyhouz Events</option>
                </select>
            </div>

            <div class="pref-section">
                <p>Sort content by default using:</p>
                <div class="radio-group">
                    <label><input type="radio" name="sort" value="latest" checked> Latest</label>
                    <label><input type="radio" name="sort" value="trending"> Trending</label>
                    <label><input type="radio" name="sort" value="popular"> Most Viewed</label>
                </div>
            </div>

            <div class="pref-section">
                <p>Content Display:</p>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="showPhotos" checked> Show Photos</label>
                    <label><input type="checkbox" id="showVideos" checked> Show Videos</label>
                    <label><input type="checkbox" id="showLiveStreams" checked> Show Live Streams</label>
                    <label><input type="checkbox" id="showPartyhouz" checked> Show Partyhouz Events</label>
                </div>
            </div>

            <div class="pref-section">
                <p>Notifications:</p>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="notifyLiveStreams" checked> Notify when friends go live</label>
                    <label><input type="checkbox" id="notifyPartyhouz"> Notify about upcoming events</label>
                </div>
            </div>

            <div class="pref-section">
                <label for="itemsPerPage">Items per page:</label>
                <select id="itemsPerPage" class="pref-select">
                    <option value="12">12 items</option>
                    <option value="24" selected>24 items</option>
                    <option value="48">48 items</option>
                </select>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="autoplayVideos"> Autoplay videos when browsing</label>
                    <label><input type="checkbox" id="hoverAutoplayVideos"> Hover Autoplay videos when browsing</label>
                    <label><input type="checkbox" id="muteVideos" checked> Mute videos by default</label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="save-btn" onclick="saveUserPreferences()">Save Preferences</button>
        </div>
    </div>
</div>

<!-- Search Modal -->
<div id="lookingGlassSearchModal" class="modal fade" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
                <h4 class="modal-title">Search LookingGlass</h4>
            </div>
            <div class="modal-body">
                <form id="lookingGlassSearchForm" action="" method="get">
                    <div class="form-group">
                        <label for="searchKeyword">Auto complete Keyword or Name:</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" class="form-control" id="searchKeyword" name="keyword" 
                                placeholder="Enter keyword, name or username" autocomplete="off">
                            <div id="searchAutocompleteSuggestions" class="autocomplete-suggestions"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Content Type:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="contentType[]" value="photos" checked> Photos</label>
                            <label><input type="checkbox" name="contentType[]" value="videos" checked> Videos</label>
                            <label><input type="checkbox" name="contentType[]" value="live" checked> Live Streams</label>
                            <label><input type="checkbox" name="contentType[]" value="events" checked> Events</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="searchDate">Date Range:</label>
                        <select class="form-control" id="searchDate" name="dateRange">
                            <option value="any">Any time</option>
                            <option value="today">Today</option>
                            <option value="week">This week</option>
                            <option value="month">This month</option>
                            <option value="year">This year</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Search In:</label>
                        <div class="radio-group">
                            <label><input type="radio" name="searchScope" value="all" checked> All content</label>
                            <label><input type="radio" name="searchScope" value="friends"> Friends only</label>
                            <label><input type="radio" name="searchScope" value="following"> Following only</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="searchSortBy">Sort By:</label>
                        <select class="form-control" id="searchSortBy" name="sortBy">
                            <option value="recent">Most recent</option>
                            <option value="popular">Most popular</option>
                            <option value="relevant">Most relevant</option>
                        </select>
                    </div>
                    
                    <!-- Advanced Options Section -->
                    <div class="form-group">
                        <h5>Advanced Options</h5>
                        <div id="advancedSearchOptions">
                            <div class="form-group">
                                <label>Location:</label>
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="searchCountry">Country:</label>
                                        <select class="form-control" id="searchCountry" name="country_id" onchange="loadStates(this.value)">
                                            <option value="">Select Country</option>
                                            <!-- Countries will be populated dynamically -->
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="searchState">State/Province:</label>
                                        <select class="form-control" id="searchState" name="state_id" onchange="loadCities(this.value)" disabled>
                                            <option value="">Select State</option>
                                            <!-- States will be populated dynamically -->
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="searchCity">City:</label>
                                        <select class="form-control" id="searchCity" name="city_id" disabled>
                                            <option value="">Select City</option>
                                            <!-- Cities will be populated dynamically -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="searchTags">Tags:</label>
                                <input type="text" class="form-control" id="searchTags" name="tags" placeholder="Enter tags separated by commas">
                            </div>
                            
                            <div class="form-group">
                                <label>Content Rating:</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" name="category" value="couple" checked> Couple</label>
                                    <label><input type="checkbox" name="category" value="single_male" checked> Single Male</label>
                                    <label><input type="checkbox" name="category" value="single_female" checked> Single Female</label>
                                    <label><input type="checkbox" name="category" value="transgender" checked> Transgender</label>
                                    <label><input type="checkbox" name="category" value="nonbinary" checked> Nonbinary</label>
                                    <label><input type="checkbox" name="category" value="soft_swap" checked> Soft Swap</label>
                                    <label><input type="checkbox" name="category" value="full_swap" checked> Full Swap</label>
                                    <label><input type="checkbox" name="category" value="bdsm" checked> BDSM</label>
                                    <label><input type="checkbox" name="category" value="voyeurism" checked> Voyeurism</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitLookingGlassSearch()">Search</button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const gearModal = document.getElementById('gearModal');
    const searchModal = document.getElementById('lookingGlassSearchModal');

    // Open gear modal
    window.openGearModal = function() {
        if (gearModal) {
            gearModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
    };

    // Close gear modal
    window.closeGearModal = function() {
        if (gearModal) {
            gearModal.style.display = 'none';
            document.body.style.overflow = '';
        }
    };

    // Show search modal
    window.showSearchModal = function() {
        if (searchModal) {
            $('#lookingGlassSearchModal').modal('show');
        }
    };

    // Fix search tab click to open the search modal
    const searchTab = document.querySelector('a[data-target="#lookingGlassSearchModal"]');
    if (searchTab) {
        searchTab.addEventListener('click', function(e) {
            e.preventDefault();
            showSearchModal();
        });
    }

    // Fix gear icon click to only open the gear modal
    const gearIcon = document.querySelector('.icon_setting_gear');
    if (gearIcon) {
        gearIcon.addEventListener('click', function(e) {
            e.preventDefault();
            openGearModal();
        });
    }
});
</script>

{footer}